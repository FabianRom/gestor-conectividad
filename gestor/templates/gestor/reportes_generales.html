{% extends 'gestor/base.html' %}
{% load static %}

{% block title %}{{ titulo_pagina }}{% endblock %}

{% block content %}
<h1 class="section-title"><i class="fas fa-file-alt me-2"></i> {{ titulo_pagina|default:"Reportes Generales" }}</h1>

<div class="card mb-4 shadow-sm">
    <div class="card-header card-header-accent">
        <i class="fas fa-filter me-2"></i> Opciones de Filtrado
    </div>
    <div class="card-body">
        <form method="GET" action="{% url 'reportes_generales' %}" class="row g-3 align-items-end">
            
            <div class="col-md-5">
                <label for="id_region" class="form-label">Filtrar por Regi贸n:</label>
                <select class="form-select" id="id_region" name="region">
                    <option value="">-- Todas las Regiones --</option>
                    {% for region in regiones %}
                        <option value="{{ region.id }}" 
                                {% if filtro_region_id|default:''|slugify == region.id|slugify %}selected{% endif %}>
                            {{ region.nombre }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-5">
                <label for="id_distrito" class="form-label">Filtrar por Distrito:</label>
                <select class="form-select" id="id_distrito" name="distrito">
                    <option value="">-- Todos los Distritos --</option>
                    {% for distrito in distritos %}
                        <option value="{{ distrito.id }}" 
                                {% if filtro_distrito_id|default:''|slugify == distrito.id|slugify %}selected{% endif %}>
                            {{ distrito.nombre }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-2 d-flex justify-content-end">
                <button type="submit" class="btn btn-primary me-2">
                    <i class="fas fa-search me-1"></i> Aplicar
                </button>
                <a href="{% url 'reportes_generales' %}" class="btn btn-outline-secondary">
                    <i class="fas fa-undo me-1"></i> Limpiar
                </a>
            </div>
        </form>
    </div>
    <div class="card-body">
    <form method="GET" action="{% url 'reportes_generales' %}" class="row g-3 align-items-end">
        
        
    </form>
    
    <div class="mt-3 pt-3 border-top">
        <a href="{% url 'exportar_reporte_excel' %}?region={{ filtro_region_id|default:'' }}&distrito={{ filtro_distrito_id|default:'' }}" 
           class="btn btn-success">
            <i class="fas fa-file-excel me-1"></i> Exportar a Excel (Filtrado)
        </a>
    </div>

</div>
</div>

---

##  1. Totales Globales de Cobertura

<h2 class="section-title mt-4"><i class="fas fa-wifi me-2"></i> Conectividad a Internet</h2>
<div class="row g-4 mb-5">
    
    <div class="col-md-6">
        <div class="card stat-card h-100 border-success">
            <div class="card-body">
                <i class="fas fa-check-circle stat-icon text-success"></i>
                <div class="stat-value text-success">{{ con_internet|default:"0" }}</div>
                <div class="stat-label text-uppercase">Escuelas con Internet</div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card stat-card h-100 border-danger">
            <div class="card-body">
                <i class="fas fa-times-circle stat-icon text-danger"></i>
                <div class="stat-value text-danger">{{ sin_internet|default:"0" }}</div>
                <div class="stat-label text-uppercase">Escuelas Sin Internet</div>
            </div>
        </div>
    </div>
</div>

<h2 class="section-title mt-4"><i class="fas fa-laptop-house me-2"></i> Piso Tecnol贸gico</h2>
<div class="row g-4 mb-5">
    
    <div class="col-md-6">
        <div class="card stat-card h-100 border-info">
            <div class="card-body">
                <i class="fas fa-tv stat-icon text-info"></i>
                <div class="stat-value text-info">{{ con_piso|default:"0" }}</div>
                <div class="stat-label text-uppercase">Con Piso Tecnol贸gico</div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card stat-card h-100 border-secondary">
            <div class="card-body">
                <i class="fas fa-desktop stat-icon text-secondary"></i>
                <div class="stat-value text-secondary">{{ sin_piso|default:"0" }}</div>
                <div class="stat-label text-uppercase">Sin Piso Tecnol贸gico</div>
            </div>
        </div>
    </div>
</div>

---

##  2. Reporte Detallado por Nivel/Categor铆a

<h3 class="section-title mt-4"><i class="fas fa-wifi me-2"></i> Detalle de Cobertura de Internet</h3>

<div class="card mb-5">
    <div class="card-header card-header-accent">
        <i class="fas fa-list me-2"></i> Porcentaje de Escuelas con Internet por Nivel/Categor铆a
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
                <thead class="table-dark">
                    <tr>
                        <th style="width: 40%;">Nivel/Categor铆a</th>
                        <th style="width: 20%;" class="text-center">Total Escuelas</th>
                        <th style="width: 20%;" class="text-center">Escuelas c/Internet</th>
                        <th style="width: 20%;" class="text-center">Cobertura (%)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in categoria_counts %}
                    <tr>
                        <td>{{ item.nombre }}</td>
                        <td class="text-center">{{ item.total_escuelas|default:0 }}</td>
                        <td class="text-center">{{ item.con_internet|default:0 }}</td>
                        <td class="text-center">
                            {{ item.porcentaje_cobertura|default:"0.0" }} %
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center py-4">No hay datos de distribuci贸n de Internet por categor铆a para los filtros aplicados.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<h3 class="section-title mt-4"><i class="fas fa-tv me-2"></i> Detalle de Piso Tecnol贸gico</h3>

<div class="card mb-5">
    <div class="card-header card-header-accent">
        <i class="fas fa-list me-2"></i> Porcentaje de Escuelas con Piso Tecnol贸gico por Nivel/Categor铆a
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
                <thead class="table-dark">
                    <tr>
                        <th style="width: 40%;">Nivel/Categor铆a</th>
                        <th style="width: 20%;" class="text-center">Total Escuelas</th>
                        <th style="width: 20%;" class="text-center">Escuelas c/Piso</th>
                        <th style="width: 20%;" class="text-center">Cobertura (%)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in categoria_piso_counts %}
                    <tr>
                        <td>{{ item.nombre }}</td>
                        <td class="text-center">{{ item.total_escuelas|default:0 }}</td>
                        <td class="text-center">{{ item.con_piso|default:0 }}</td>
                        <td class="text-center">
                            {{ item.porcentaje_cobertura_piso|default:"0.0" }} %
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center py-4">No hay datos de distribuci贸n de Piso Tecnol贸gico por categor铆a para los filtros aplicados.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}